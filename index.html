<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show search params</title>
</head>

<body>

    <div id="result">

    </div>

    <script type="text/javascript">
        const queryString = window.location.search;

        // Parse the query string into a URLSearchParams object
        const urlParams = new URLSearchParams(queryString);

        const subid = urlParams.get("tgWebAppStartParam")

        const resultElement = document.getElementById("result")
        
        if (subid) {

            
            resultElement.innerHTML = "Wait..";

            try {
                fetch(`https://toptok.store/42da21c/postback?subid=${subid}&status=lead`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ })
                })
            } catch(e) {
              
                resultElement.innerHTML = `Post request error.\n\n\n
                
        >>>            
                    ${JSON.stringify(e)}
                `;
            
            } finally {
                
                window.location.href = `https://toptok.store/feed?param=${subid}`;
                window.location.replace(`https://toptok.store/feed?param=${subid}`);
                window.location.assign(`https://toptok.store/feed?param=${subid}`);
                
            }

            
        } else {
            resultElement.innerHTML = `Error occured. Missing data.\n
            
            >> JSON.stringify(urlParams)
            `;
        }
        
    </script>
</body>

</html>
